
type User @model 
@auth(rules: [
  
  ## Owners can do everything
  { allow: owner, operations: [create, update, delete] },
  
  # Admin users can access any operation.
  { allow: groups, groups: ["admin"] }

]) {
  id: ID!
  

  firstName: String!
  lastName: String!
  
  imageUrl: AWSURL!


  establishments: [EstablishmentTibi] @connection(keyName: "byUser", fields: ["id"])
}


enum ImageLocation {
  system
  assets
  remote
}

enum EstablishmentType {
  hotel
  custom
}


type ImagePath @model
@auth(rules: [
  { allow: owner },
  { allow: groups, groups: ["admin"] }
]) {
  key: String!
  location: ImageLocation!
}

type Occupation @model
@key(name: "byEstablishment", fields: ["establishmentId", "name"])
@auth(rules: [

  { allow: owner, operations: [create, update, delete] },
  { allow: groups, groups: ["admin"] }
]) {
  id: ID!
  establishmentId: ID!
  name: String!

  backgroundImage: ImagePath! @connection
}


type Establishment @model
@auth(rules: [
  ## Owners can do everything
  { allow: owner, operations: [create, update, delete] },
  
  ## Admin users can access any operation.
  { allow: groups, groups: ["admin"] },

  { allow: public, operations: [read] }
]) {
  id: ID!

  ## Name for establishment
  name: String!

  ## This is either sole-proprieter or organization
  type: EstablishmentType!


  website: AWSURL

  

  tibis: [EstablishmentTibi] @connection(keyName: "byEstablishment", fields: ["id"])
  occupations: [Occupation] @connection(keyName: "byEstablishment", fields: ["id"])
}


type EstablishmentTibi
@model(queries: null)
@key(name: "byEstablishment", fields: ["establishmentId", "userId"])
@key(name: "byUser", fields: ["userId", "establishmentId"])
@auth(rules: [
  { allow: owner, operations: [create, update, delete] },
  { allow: groups, groups: ["admin"] }
]) {
  id: ID!
  userId: ID!
  establishmentId: ID!
  establishment: Establishment! @connection(fields: ["establishmentId"])
  user: User! @connection(fields: ["userId"])
  roles: [String]!
}
